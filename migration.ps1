. .\logger.ps1
function MigrateScriptTest {
    Param(
        [string]$sourceURL,
        [string]$listURL,
        [string]$destURL,
        [string]$listStub        
    )
    $sourceURL = [uri]::EscapeUriString($sourceURL)
    $listURL = [uri]::EscapeUriString($listURL)
    $destURL = [uri]::EscapeUriString($destURL)
    Write-Host("Source: " + $sourceURL);
    Write-Host("List: " + $listURL);
    Write-Host("Destination: " + $destURL);
    Write-Host("Stub: " + $listStub);
}
function MigrateScript {
    Param(
        [string]$sourceURL,
        [string]$listURL,
        [string]$destURL,
        [string]$listStub        
    )
    $sourceURL = [uri]::EscapeUriString($sourceURL)
    $listURL = [uri]::EscapeUriString($listURL)
    $destURL = [uri]::EscapeUriString($destURL)
    Write-Host("Source: " + $sourceURL);
    Write-Host("List: " + $listURL);
    Write-Host("Destination: " + $destURL);
    Write-Host("Stub: " + $listStub);

    if ( $PsVersionTable.PSVersion.Major -lt 3 ) { Write-Host "Windows PowerShell Version 3.0 or later needs to be installed in order to execute Content Matrix PowerShell scripts."; exit; }
    if ( (Get-PSSnapin -Name Metalogix.System.Commands -ErrorAction SilentlyContinue) -eq $null ) { add-pssnapin Metalogix.System.Commands | out-null }
    if ( (Get-PSSnapin -Name Metalogix.SharePoint.Migration.Commands -ErrorAction SilentlyContinue) -eq $null ) { add-pssnapin Metalogix.SharePoint.Migration.Commands | out-null }
    
    ## Set default resolvers
    Set-MetalogixDefaultResolverSetting -Name "NodeLocation" -Value "Metalogix.Explorer.PersistentConnectionsResolver, Metalogix.Explorer, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03"
    Set-MetalogixDefaultResolverSetting -Name "ResourceTableResourceTableLink" -Value "Metalogix.ResourceFileTableResolver, Metalogix.Core, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03"
    Set-MetalogixDefaultResolverSetting -Name "DataResolverDataRepositoryLink" -Value "Metalogix.Client.ClientDataRepositoryResolver, Metalogix.Client, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03"
    
    ## Load configuration settings
    Load-MetalogixConfigurationVariableSettings -FilePath "C:\Users\MHerve\AppData\Roaming\Metalogix\UserSettings.xml" -Scope UserSpecific
    Load-MetalogixConfigurationVariableSettings -FilePath "C:\Users\MHerve\AppData\Roaming\Metalogix\Content Matrix Console - SharePoint Edition\ApplicationSettings.xml" -Scope ApplicationAndUserSpecific
    Load-MetalogixConfigurationVariableSettings -FilePath "C:\ProgramData\Metalogix\EnvironmentSettings.xml" -Scope EnvironmentSpecific
    
    ## Load source
    #$SourceCollection = New-MetalogixSerializableObjectCollection "<IXMLAbleList IXMLAbleType=`"Metalogix.Explorer.NodeCollection, Metalogix.Explorer, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`"><NodeCollection><Location Path=`"/AAR  Riverbed`" DisplayUrl=`"https://my.jhpiego.org/InformationTechnology/Lists/AAR  Riverbed`"><Connection NodeType=`"Metalogix.SharePoint.SPWeb, Metalogix.SharePoint, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" SharePointVersion=`"14.0.7015.1000`" UnderlyingAdapterType=`"WS`" ShowAllSites=`"True`" AdapterType=`"WS`" Url=`"https://my.jhpiego.org/informationtechnology`" ReadOnly=`"False`" AuthenticationType=`"Metalogix.SharePoint.Adapters.Authentication.WindowsInitializer`" /></Location></NodeCollection></IXMLAbleList>"
    $SourceCollection = New-MetalogixSerializableObjectCollection "<IXMLAbleList IXMLAbleType=`"Metalogix.Explorer.NodeCollection, Metalogix.Explorer, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`"><NodeCollection><Location Path=`"$($listStub)`" DisplayUrl=`"$($listURL)`"><Connection NodeType=`"Metalogix.SharePoint.SPWeb, Metalogix.SharePoint, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" SharePointVersion=`"14.0.7015.1000`" UnderlyingAdapterType=`"WS`" ShowAllSites=`"True`" AdapterType=`"WS`" Url=`"$($sourceURL)`" ReadOnly=`"False`" AuthenticationType=`"Metalogix.SharePoint.Adapters.Authentication.WindowsInitializer`" /></Location></NodeCollection></IXMLAbleList>"
    
    ## Load target
    #$TargetCollection = New-MetalogixSerializableObjectCollection "<IXMLAbleList IXMLAbleType=`"Metalogix.Explorer.NodeCollection, Metalogix.Explorer, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`"><NodeCollection><Location Path=`"`" DisplayUrl=`"https://jhpiego.sharepoint.com/sites/POC`"><Connection NodeType=`"Metalogix.SharePoint.SPWeb, Metalogix.SharePoint, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" SharePointVersion=`"2147483647.0.0.0`" UnderlyingAdapterType=`"CSOM`" ShowAllSites=`"True`" AdapterType=`"CSOM`" Url=`"https://jhpiego.sharepoint.com/sites/POC`" UserName=`"mherve@jhpiego.org`" SavePassword=`"True`" Password=`"AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAU8p9ki0svEikLrTbEJyb1QAAAAACAAAAAAADZgAAwAAAABAAAACwrkw7FGtsfeHJMWcjn016AAAAAASAAACgAAAAEAAAAIlvTjTctiTI8U+lDLGtIAAYAAAAgbIWDnto2r1XgpkmeLgXEIaf7fXcgkz/FAAAAF7Mi/5NjK0x9H+FxpEMvl9keXkd`" ReadOnly=`"False`" AuthenticationType=`"Metalogix.SharePoint.Adapters.Authentication.Office365StandADFSInitializer`" /></Location></NodeCollection></IXMLAbleList>"
    $TargetCollection = New-MetalogixSerializableObjectCollection "<IXMLAbleList IXMLAbleType=`"Metalogix.Explorer.NodeCollection, Metalogix.Explorer, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`"><NodeCollection><Location Path=`"`" DisplayUrl=`"$($destURL)`"><Connection NodeType=`"Metalogix.SharePoint.SPWeb, Metalogix.SharePoint, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" SharePointVersion=`"2147483647.0.0.0`" UnderlyingAdapterType=`"CSOM`" ShowAllSites=`"True`" AdapterType=`"CSOM`" Url=`"$($destUrl)`" UserName=`"mherve@jhpiego.org`" SavePassword=`"True`" Password=`"AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAU8p9ki0svEikLrTbEJyb1QAAAAACAAAAAAADZgAAwAAAABAAAACwrkw7FGtsfeHJMWcjn016AAAAAASAAACgAAAAEAAAAIlvTjTctiTI8U+lDLGtIAAYAAAAgbIWDnto2r1XgpkmeLgXEIaf7fXcgkz/FAAAAF7Mi/5NjK0x9H+FxpEMvl9keXkd`" ReadOnly=`"False`" AuthenticationType=`"Metalogix.SharePoint.Adapters.Authentication.Office365StandADFSInitializer`" /></Location></NodeCollection></IXMLAbleList>"    
    ## Run the action
    foreach ($Target in $TargetCollection) {
        $SourceCollection | Copy-MLSharePointList -Target $Target  -UpdateLists "All" -CheckModifiedDatesForLists -CopyListItems -UseAzureOffice365Upload -EncryptAzureMigrationJobs -CopyContentZoneContent -CheckModifiedDatesForItemsDocuments -UpdateItems "All" -ReattachPageLayouts -CopyVersions -CopySubFolders -PreserveItemIDs -ResolveManagedMetadataByName -CopyReferencedManagedMetadata -MigrationMode "Incremental" -ForceRefresh -CorrectingLinks -LinkCorrectionScope "SiteCollection" -MapGroupsByName -MapMissingUsersToLoginName "archive@jhpiego.net" -OverrideCheckouts -Transformers ( New-MetalogixSerializableObject "Metalogix.Transformers.TransformerCollection" "Metalogix.Actions" "<TransformerCollection><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.ContentTypeFieldMapper, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.DocumentSetsFolderApplicator, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.ReferencedFolderDataUpdater, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.FolderColumnMapper, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.ManagedMetadataItemValueMapper, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.DeletionPropagator, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.ReferencedListItemDataUpdater, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.DocumentSetsApplicator, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.ContentTypesApplicator, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.ListItemColumnMapper, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.WorkflowDataUpdater, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.PublishingDataUpdater, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.InfopathItemContentXml, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.ListColumnMapper, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.BDCUpdater, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.ListGuidMapper, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.MapUsers, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /><Transformer TransformerType=`"Metalogix.Commands.PowerShellTransformer``4[[Metalogix.SharePoint.SPUser, Metalogix.SharePoint, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03],[Metalogix.SharePoint.Actions.Migration.CopyUsersAction, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03],[Metalogix.SharePoint.SPUserCollection, Metalogix.SharePoint, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03],[Metalogix.SharePoint.SPUserCollection, Metalogix.SharePoint, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03]], Metalogix.System.Commands, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"False`"><BeginScriptLocation Type=`"Metalogix.Commands.ScriptFileLocation`">None</BeginScriptLocation><TransformScriptLocation Type=`"Metalogix.Commands.ScriptFileLocation`">File</TransformScriptLocation><EndScriptLocation Type=`"Metalogix.Commands.ScriptFileLocation`">None</EndScriptLocation><BeginTranformScriptFileName Type=`"System.String`" /><TransformScriptFileName Type=`"System.String`">C:\Users\MHerve\Downloads\MetalogixUserMappingTransformer_SupportNonDotComDomains.ps1</TransformScriptFileName><EndTransformScriptFileName Type=`"System.String`" /><FullBeginTransformScript Type=`"System.String`" /><FullTransformScript Type=`"System.String`" /><FullEndTransformScript Type=`"System.String`" /></Transformer><Transformer TransformerType=`"Metalogix.SharePoint.Actions.Transform.WebPartsProcessor, Metalogix.SharePoint.Actions, Version=8.5.0.4, Culture=neutral, PublicKeyToken=3b240fac3e39fc03`" ReadOnly=`"True`" /></TransformerCollection>" -Enumerate) -jobfile "C:\Users\MHerve\AppData\Roaming\Metalogix\Content Matrix Console - SharePoint Edition\JobHistory.lst"
    }
     
}
    